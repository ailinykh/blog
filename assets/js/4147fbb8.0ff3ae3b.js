"use strict";(self.webpackChunkailinykh_com=self.webpackChunkailinykh_com||[]).push([[7263],{4562:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>t,toc:()=>c});var t=i(7072),r=i(4848),s=i(8453);const a={slug:"mikrotik-ipsec-l2tp-bgp-routing",title:"Mikrotik vs Roskomnadzor",authors:["anton"],tags:["mikrotik","ipsec","l2tp","bgp","dns","\u0440\u043e\u0441\u043a\u043e\u043c\u043d\u0430\u0434\u0437\u043e\u0440","\u043e\u0431\u0445\u043e\u0434 \u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043e\u043a"]},o=void 0,l={authorsImageUrls:[void 0]},c=[{value:"Step I. Run IPSeC server",id:"step-i-run-ipsec-server",level:3},{value:"Step II. L2TP client setup",id:"step-ii-l2tp-client-setup",level:3},{value:"Step III. BGP configuration",id:"step-iii-bgp-configuration",level:3},{value:"Step IV. Firewall configuration",id:"step-iv-firewall-configuration",level:2},{value:"Step V. DNS configuratoin (optional)",id:"step-v-dns-configuratoin-optional",level:2}];function p(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["For research purposes, you may need to access certain resources from ",(0,r.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Internet_censorship_in_Russia#Internet_blacklist",children:"Roskomnadzor\u2019s blacklist"}),", which may be restricted in your country."]}),"\n",(0,r.jsx)(n.p,{children:"There are five small steps to bypass the blacklist using a MikroTik router and an IPsec/L2TP connection on a simple VPS running a Docker container."}),"\n",(0,r.jsx)(n.h3,{id:"step-i-run-ipsec-server",children:"Step I. Run IPSeC server"}),"\n",(0,r.jsxs)(n.p,{children:["There are many ways to do this, but I prefer running a simple Docker container on your VPS. On your server, create a ",(0,r.jsx)(n.code,{children:"compose.yml"})," file with the following content, replacing ",(0,r.jsx)(n.code,{children:"YOUR_SHARED_SECRET"})," with a securely generated random password."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'services:\n  ipsec:\n    image: hwdsl2/ipsec-vpn-server\n    restart: always\n    environment:\n      VPN_IPSEC_PSK: YOUR_SHARED_SECRET\n      VPN_USER: mikrotik\n      VPN_PASSWORD: mikrotik\n    ports:\n      - "500:500/udp"\n      - "4500:4500/udp"\n    privileged: true\n    hostname: ipsec-vpn-server\n    container_name: ipsec-vpn-server\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Save the file, then run ",(0,r.jsx)(n.code,{children:"docker compose up -d"})," container and wait for the container to start."]}),"\n",(0,r.jsx)(n.h3,{id:"step-ii-l2tp-client-setup",children:"Step II. L2TP client setup"}),"\n",(0,r.jsx)(n.p,{children:"Next, retrieve your VPS hostname or IP address and create a new L2TP client on your MikroTik router using the following terminal command"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"[admin@MikroTik] > interface l2tp-client add disabled=no name=l2tp-out connect-to=<YOUR_HOST_IP> user=mikrotik password=mikrotik use-ipsec=yes ipsec-secret=<YOUR_SHARED_SECRET>\n[admin@MikroTik] > interface l2tp-client add name=l2tp-out connect-to=<YOUR_HOST_IP> user=mikrotik password=mikrotik use-ipsec=yes ipsec-secret=<YOUR_SHARED_SECRET>\n"})}),"\n",(0,r.jsx)(n.p,{children:"Check it's working"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"[admin@MikroTik] > ping github.com interface=l2tp-out\n"})}),"\n",(0,r.jsx)(n.p,{children:"If you receive an ICMP response, it means everything is working perfectly"}),"\n",(0,r.jsx)(n.h3,{id:"step-iii-bgp-configuration",children:"Step III. BGP configuration"}),"\n",(0,r.jsxs)(n.p,{children:["There are several services, such as ",(0,r.jsx)(n.a,{href:"https://antifilter.download/",children:"antifilter.download"})," and ",(0,r.jsx)(n.a,{href:"https://antifilter.network/",children:"antifilter.network"}),", that provide blacklisted routes from RKN."]}),"\n",(0,r.jsx)(n.p,{children:"These services can automatically configure your router via BGP, eliminating the need to update lists manually every day."}),"\n",(0,r.jsxs)(n.p,{children:["To set up BGP, visit ",(0,r.jsx)(n.a,{href:"https://antifilter.network/bgp",children:"antifilter.network bgp page"})," and obtain your ",(0,r.jsx)(n.code,{children:"ASN"}),", ",(0,r.jsx)(n.code,{children:"Router ID"})," (your IP address), and ",(0,r.jsx)(n.code,{children:"Service IP"})]}),"\n",(0,r.jsx)(n.p,{children:"Create template"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"[admin@MikroTik] > /routing/bgp template add as=64999 disabled=no hold-time=4m input.filter=bgp_in .ignore-ad-path-len=yes keepalive-time=1m multihop=yes name=antifilter routing-table=main\n"})}),"\n",(0,r.jsx)(n.p,{children:"...and connection"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"[admin@MikroTik] > /routing/bgp connection add disabled=no hold-time=4m input.filter=bgp_in .ignore-ad-path-len=yes keepalive=time=1m local.role=ebgp multihop=yes name=antifilter_bgp remote.address=51.75.66.20/32 .as=65444 router-id=<YOUR_IP_ADDRESS> routing-table=main templates=antifilter\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Wait ",(0,r.jsx)(n.strong,{children:"around 5 minutes"})," and see if everything works"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'[admin@MikroTik] > /routing/bgp/session print  \nFlags: E - established \n 0 E name="antifilter_bgp-1" \n     remote.address=45.148.244.55 .as=65444 .id=10.75.66.2 .capabilities=mp,rr,gr,as4,err,llgr .afi=ip,ipv6 .hold-time=4m \n     .messages=11991 .bytes=1011967 .gr-time=120 .eor=ip \n     local.address=192.168.88.1 .as=64999 .id=<YOUR_IP_ADDRESS> .cluster-id=<YOUR_IP_ADDRESS> .capabilities=mp,rr,gr,as4 .afi=ip \n     .messages=4 .bytes=76 .eor="" \n     output.procid=20 \n     input.procid=20 .filter=bgp_in .ignore-as-path-len=yes ebgp \n     multihop=yes hold-time=4m keepalive-time=1m uptime=3m1s320ms last-started=2025-02-15 12:22:37 prefix-count=19725 \n'})}),"\n",(0,r.jsxs)(n.p,{children:["At the end of the output, you'll see the number of prefixes: ",(0,r.jsx)(n.code,{children:"prefix-count=19725"})]}),"\n",(0,r.jsx)(n.h2,{id:"step-iv-firewall-configuration",children:"Step IV. Firewall configuration"}),"\n",(0,r.jsx)(n.p,{children:"To route traffic through the correct gateway, add the following rule to Mikrotik's firewall"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'[admin@MikroTik] > /routing/filter/rule add chain=bgp_in disabled=no rule="set gw l2tp-out; accept;"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"step-v-dns-configuratoin-optional",children:"Step V. DNS configuratoin (optional)"}),"\n",(0,r.jsxs)(n.p,{children:["To avoid seeing unwanted ads, you can also use a DNS blocking service like ",(0,r.jsx)(n.a,{href:"https://adguard-dns.io/en/blog/adguard-dns-new-addresses.html",children:"AdGuard DNS"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"[admin@MikroTik] > /ip/dns set servers=94.140.14.14,94.140.15.15\n"})}),"\n",(0,r.jsx)(n.p,{children:"Enjoy!"})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},7072:e=>{e.exports=JSON.parse('{"permalink":"/mikrotik-ipsec-l2tp-bgp-routing","editUrl":"https://github.com/ailinykh/blog/edit/master/blog/2025-02-14-mikrotik-ipsec.md","source":"@site/blog/2025-02-14-mikrotik-ipsec.md","title":"Mikrotik vs Roskomnadzor","description":"For research purposes, you may need to access certain resources from Roskomnadzor\u2019s blacklist, which may be restricted in your country.","date":"2025-02-14T00:00:00.000Z","tags":[{"inline":true,"label":"mikrotik","permalink":"/tags/mikrotik"},{"inline":true,"label":"ipsec","permalink":"/tags/ipsec"},{"inline":true,"label":"l2tp","permalink":"/tags/l-2-tp"},{"inline":true,"label":"bgp","permalink":"/tags/bgp"},{"inline":true,"label":"dns","permalink":"/tags/dns"},{"inline":true,"label":"\u0440\u043e\u0441\u043a\u043e\u043c\u043d\u0430\u0434\u0437\u043e\u0440","permalink":"/tags/\u0440\u043e\u0441\u043a\u043e\u043c\u043d\u0430\u0434\u0437\u043e\u0440"},{"inline":true,"label":"\u043e\u0431\u0445\u043e\u0434 \u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043e\u043a","permalink":"/tags/\u043e\u0431\u0445\u043e\u0434-\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043e\u043a"}],"readingTime":2.89,"hasTruncateMarker":true,"authors":[{"name":"Anton Ilinykh","title":"Software Engineer","imageURL":"https://avatars.githubusercontent.com/u/939390?s=400&v=4","key":"anton","page":null}],"frontMatter":{"slug":"mikrotik-ipsec-l2tp-bgp-routing","title":"Mikrotik vs Roskomnadzor","authors":["anton"],"tags":["mikrotik","ipsec","l2tp","bgp","dns","\u0440\u043e\u0441\u043a\u043e\u043c\u043d\u0430\u0434\u0437\u043e\u0440","\u043e\u0431\u0445\u043e\u0434 \u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043e\u043a"]},"unlisted":false,"prevItem":{"title":"Ngrok selfhosted alternative","permalink":"/free-selfhosted-ngrok-alternative"},"nextItem":{"title":"FFMPEG cheatsheet","permalink":"/ffmpeg-cheatsheet"}}')},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>o});var t=i(6540);const r={},s=t.createContext(r);function a(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);